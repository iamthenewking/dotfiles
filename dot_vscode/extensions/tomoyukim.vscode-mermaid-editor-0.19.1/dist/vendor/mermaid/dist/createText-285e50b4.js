import{l as log,H as decodeEntities}from"./mermaid-a98f434b.js";import{fromMarkdown}from"mdast-util-from-markdown";import{dedent}from"ts-dedent";function preprocessMarkdown(t){const e=t.replace(/\n{2,}/g,"\n");return dedent(e)}function markdownToLines(t){const e=preprocessMarkdown(t),{children:n}=fromMarkdown(e),o=[[]];let r=0;function i(t,e="normal"){"text"===t.type?t.value.split("\n").forEach(((t,n)=>{0!==n&&(r++,o.push([])),t.split(" ").forEach((t=>{t&&o[r].push({content:t,type:e})}))})):"strong"!==t.type&&"emphasis"!==t.type||t.children.forEach((e=>{i(e,t.type)}))}return n.forEach((t=>{"paragraph"===t.type&&t.children.forEach((t=>{i(t)}))})),o}function markdownToHTML(t){const{children:e}=fromMarkdown(t);return e.map((function t(e){return"text"===e.type?e.value.replace(/\n/g,"<br/>"):"strong"===e.type?`<strong>${e.children.map(t).join("")}</strong>`:"emphasis"===e.type?`<em>${e.children.map(t).join("")}</em>`:"paragraph"===e.type?`<p>${e.children.map(t).join("")}</p>`:`Unsupported markdown: ${e.type}`})).join("")}function splitTextToChars(t){return Intl.Segmenter?[...(new Intl.Segmenter).segment(t)].map((t=>t.segment)):[...t]}function splitWordToFitWidth(t,e){return splitWordToFitWidthRecursion(t,[],splitTextToChars(e.content),e.type)}function splitWordToFitWidthRecursion(t,e,n,o){if(0===n.length)return[{content:e.join(""),type:o},{content:"",type:o}];const[r,...i]=n,s=[...e,r];return t([{content:s.join(""),type:o}])?splitWordToFitWidthRecursion(t,s,i,o):(0===e.length&&r&&(e.push(r),n.shift()),[{content:e.join(""),type:o},{content:n.join(""),type:o}])}function splitLineToFitWidth(t,e){if(t.some((({content:t})=>t.includes("\n"))))throw new Error("splitLineToFitWidth does not support newlines in the line");return splitLineToFitWidthRecursion(t,e)}function splitLineToFitWidthRecursion(t,e,n=[],o=[]){if(0===t.length)return o.length>0&&n.push(o),n.length>0?n:[];let r="";" "===t[0].content&&(r=" ",t.shift());const i=t.shift()??{content:" ",type:"normal"},s=[...o];if(""!==r&&s.push({content:r,type:"normal"}),s.push(i),e(s))return splitLineToFitWidthRecursion(t,e,n,s);if(o.length>0)n.push(o),t.unshift(i);else if(i.content){const[o,r]=splitWordToFitWidth(e,i);n.push([o]),r.content&&t.unshift(r)}return splitLineToFitWidthRecursion(t,e,n)}function applyStyle(t,e){e&&t.attr("style",e)}function addHtmlSpan(t,e,n,o,r=!1){const i=t.append("foreignObject"),s=i.append("xhtml:div"),a=e.label,l=e.isNode?"nodeLabel":"edgeLabel";s.html(`\n    <span class="${l} ${o}" `+(e.labelStyle?'style="'+e.labelStyle+'"':"")+">"+a+"</span>"),applyStyle(s,e.labelStyle),s.style("display","table-cell"),s.style("white-space","nowrap"),s.style("max-width",n+"px"),s.attr("xmlns","http://www.w3.org/1999/xhtml"),r&&s.attr("class","labelBkg");let p=s.node().getBoundingClientRect();return p.width===n&&(s.style("display","table"),s.style("white-space","break-spaces"),s.style("width",n+"px"),p=s.node().getBoundingClientRect()),i.style("width",p.width),i.style("height",p.height),i.node()}function createTspan(t,e,n){return t.append("tspan").attr("class","text-outer-tspan").attr("x",0).attr("y",e*n-.1+"em").attr("dy",n+"em")}function computeWidthOfText(t,e,n){const o=t.append("text"),r=createTspan(o,1,e);updateTextContentAndStyles(r,n);const i=r.node().getComputedTextLength();return o.remove(),i}function createFormattedText(t,e,n,o=!1){const r=e.append("g"),i=r.insert("rect").attr("class","background"),s=r.append("text").attr("y","-10.1");let a=0;for(const e of n){const n=e=>computeWidthOfText(r,1.1,e)<=t,o=n(e)?[e]:splitLineToFitWidth(e,n);for(const t of o)updateTextContentAndStyles(createTspan(s,a,1.1),t),a++}if(o){const t=s.node().getBBox(),e=2;return i.attr("x",-e).attr("y",-e).attr("width",t.width+2*e).attr("height",t.height+2*e),r.node()}return s.node()}function updateTextContentAndStyles(t,e){t.text(""),e.forEach(((e,n)=>{const o=t.append("tspan").attr("font-style","emphasis"===e.type?"italic":"normal").attr("class","text-inner-tspan").attr("font-weight","strong"===e.type?"bold":"normal");0===n?o.text(e.content):o.text(" "+e.content)}))}const createText=(t,e="",{style:n="",isTitle:o=!1,classes:r="",useHtmlLabels:i=!0,isNode:s=!0,width:a=200,addSvgBackground:l=!1}={})=>{if(log.info("createText",e,n,o,r,i,s,l),i){const o=markdownToHTML(e);return addHtmlSpan(t,{isNode:s,label:decodeEntities(o).replace(/fa[blrs]?:fa-[\w-]+/g,(t=>`<i class='${t.replace(":"," ")}'></i>`)),labelStyle:n.replace("fill:","color:")},a,r,l)}return createFormattedText(a,t,markdownToLines(e),l)};export{createText as c};