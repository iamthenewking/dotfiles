import{p as parser,d as db,s as styles}from"./styles-88ad4441.js";import{select}from"d3";import{layout}from"dagre-d3-es/src/dagre/index.js";import*as graphlib from"dagre-d3-es/src/graphlib/index.js";import{c as getConfig,l as log,i as configureSvgSize}from"./mermaid-a98f434b.js";import{s as svgDraw}from"./svgDraw-5d8a058e.js";import"ts-dedent";import"dayjs";import"@braintree/sanitize-url";import"dompurify";import"khroma";import"lodash-es/memoize.js";import"stylis";import"lodash-es/isEmpty.js";let idCache={};const padding=20,getGraphId=function(t){const r=Object.entries(idCache).find((r=>r[1].label===t));if(r)return r[0]},insertMarkers=function(t){t.append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),t.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),t.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),t.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z")},draw=function(t,r,a,e){const d=getConfig().class;idCache={},log.info("Rendering diagram "+t);const n=getConfig().securityLevel;let i;"sandbox"===n&&(i=select("#i"+r));const o=select("sandbox"===n?i.nodes()[0].contentDocument.body:"body"),s=o.select(`[id='${r}']`);var p;(p=s).append("defs").append("marker").attr("id","extensionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 1,7 L18,13 V 1 Z"),p.append("defs").append("marker").attr("id","extensionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 1,1 V 13 L18,7 Z"),p.append("defs").append("marker").attr("id","compositionStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),p.append("defs").append("marker").attr("id","compositionEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),p.append("defs").append("marker").attr("id","aggregationStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),p.append("defs").append("marker").attr("id","aggregationEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L1,7 L9,1 Z"),p.append("defs").append("marker").attr("id","dependencyStart").attr("class","extension").attr("refX",0).attr("refY",7).attr("markerWidth",190).attr("markerHeight",240).attr("orient","auto").append("path").attr("d","M 5,7 L9,13 L1,7 L9,1 Z"),p.append("defs").append("marker").attr("id","dependencyEnd").attr("refX",19).attr("refY",7).attr("markerWidth",20).attr("markerHeight",28).attr("orient","auto").append("path").attr("d","M 18,7 L9,13 L14,7 L9,1 Z");const g=new graphlib.Graph({multigraph:!0});g.setGraph({isMultiGraph:!0}),g.setDefaultEdgeLabel((function(){return{}}));const f=e.db.getClasses(),m=Object.keys(f);for(const t of m){const r=f[t],a=svgDraw.drawClass(s,r,d,e);idCache[a.id]=a,g.setNode(a.id,a),log.info("Org height: "+a.height)}e.db.getRelations().forEach((function(t){log.info("tjoho"+getGraphId(t.id1)+getGraphId(t.id2)+JSON.stringify(t)),g.setEdge(getGraphId(t.id1),getGraphId(t.id2),{relation:t},t.title||"DEFAULT")})),e.db.getNotes().forEach((function(t){log.debug(`Adding note: ${JSON.stringify(t)}`);const r=svgDraw.drawNote(s,t,d,e);idCache[r.id]=r,g.setNode(r.id,r),t.class&&t.class in f&&g.setEdge(t.id,getGraphId(t.class),{relation:{id1:t.id,id2:t.class,relation:{type1:"none",type2:"none",lineType:10}}},"DEFAULT")})),layout(g),g.nodes().forEach((function(t){void 0!==t&&void 0!==g.node(t)&&(log.debug("Node "+t+": "+JSON.stringify(g.node(t))),o.select("#"+(e.db.lookUpDomId(t)||t)).attr("transform","translate("+(g.node(t).x-g.node(t).width/2)+","+(g.node(t).y-g.node(t).height/2)+" )"))})),g.edges().forEach((function(t){void 0!==t&&void 0!==g.edge(t)&&(log.debug("Edge "+t.v+" -> "+t.w+": "+JSON.stringify(g.edge(t))),svgDraw.drawEdge(s,g.edge(t),g.edge(t).relation,d,e))}));const h=s.node().getBBox(),c=h.width+40,l=h.height+40;configureSvgSize(s,l,c,d.useMaxWidth);const k=`${h.x-20} ${h.y-20} ${c} ${l}`;log.debug(`viewBox ${k}`),s.attr("viewBox",k)},renderer={draw},diagram={parser,db,renderer,styles,init:t=>{t.class||(t.class={}),t.class.arrowMarkerAbsolute=t.arrowMarkerAbsolute,db.clear()}};export{diagram};