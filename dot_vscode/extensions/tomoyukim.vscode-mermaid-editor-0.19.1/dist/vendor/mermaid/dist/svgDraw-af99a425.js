import{F as k,z as v,l as f,G as N}from"./mermaid-42f7bf2b.js";import{l as I}from"./line-ce5d1152.js";let S=0;const O=function(t,e,i,n,a){const r=function(t){switch(t){case a.db.relationType.AGGREGATION:return"aggregation";case a.db.relationType.EXTENSION:return"extension";case a.db.relationType.COMPOSITION:return"composition";case a.db.relationType.DEPENDENCY:return"dependency";case a.db.relationType.LOLLIPOP:return"lollipop"}};e.points=e.points.filter((t=>!Number.isNaN(t.y)));const d=e.points,s=I().x((function(t){return t.x})).y((function(t){return t.y})).curve(k),o=t.append("path").attr("d",s(d)).attr("id","edge"+S).attr("class","relation");let l,c,p="";n.arrowMarkerAbsolute&&(p=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search,p=p.replace(/\(/g,"\\("),p=p.replace(/\)/g,"\\)")),1==i.relation.lineType&&o.attr("class","relation dashed-line"),10==i.relation.lineType&&o.attr("class","relation dotted-line"),"none"!==i.relation.type1&&o.attr("marker-start","url("+p+"#"+r(i.relation.type1)+"Start)"),"none"!==i.relation.type2&&o.attr("marker-end","url("+p+"#"+r(i.relation.type2)+"End)");const g=e.points.length;let h,x,y,u,b=v.calcLabelPosition(e.points);if(l=b.x,c=b.y,g%2!=0&&g>1){let t=v.calcCardinalityPosition("none"!==i.relation.type1,e.points,e.points[0]),n=v.calcCardinalityPosition("none"!==i.relation.type2,e.points,e.points[g-1]);f.debug("cardinality_1_point "+JSON.stringify(t)),f.debug("cardinality_2_point "+JSON.stringify(n)),h=t.x,x=t.y,y=n.x,u=n.y}if(void 0!==i.title){const e=t.append("g").attr("class","classLabel"),a=e.append("text").attr("class","label").attr("x",l).attr("y",c).attr("fill","red").attr("text-anchor","middle").text(i.title);window.label=a;const r=a.node().getBBox();e.insert("rect",":first-child").attr("class","box").attr("x",r.x-n.padding/2).attr("y",r.y-n.padding/2).attr("width",r.width+n.padding).attr("height",r.height+n.padding)}f.info("Rendering relation "+JSON.stringify(i)),void 0!==i.relationTitle1&&"none"!==i.relationTitle1&&t.append("g").attr("class","cardinality").append("text").attr("class","type1").attr("x",h).attr("y",x).attr("fill","black").attr("font-size","6").text(i.relationTitle1),void 0!==i.relationTitle2&&"none"!==i.relationTitle2&&t.append("g").attr("class","cardinality").append("text").attr("class","type2").attr("x",y).attr("y",u).attr("fill","black").attr("font-size","6").text(i.relationTitle2),S++},P=function(t,e,i,n){f.debug("Rendering class ",e,i);const a=e.id,r={id:a,label:e.id,width:0,height:0},d=t.append("g").attr("id",n.db.lookUpDomId(a)).attr("class","classGroup");let s;s=e.link?d.append("svg:a").attr("xlink:href",e.link).attr("target",e.linkTarget).append("text").attr("y",i.textHeight+i.padding).attr("x",0):d.append("text").attr("y",i.textHeight+i.padding).attr("x",0);let o=!0;e.annotations.forEach((function(t){const e=s.append("tspan").text("«"+t+"»");o||e.attr("dy",i.textHeight),o=!1}));let l=E(e);const c=s.append("tspan").text(l).attr("class","title");o||c.attr("dy",i.textHeight);const p=s.node().getBBox().height,g=d.append("line").attr("x1",0).attr("y1",i.padding+p+i.dividerMargin/2).attr("y2",i.padding+p+i.dividerMargin/2),h=d.append("text").attr("x",i.padding).attr("y",p+i.dividerMargin+i.textHeight).attr("fill","white").attr("class","classText");o=!0,e.members.forEach((function(t){_(h,t,o,i),o=!1}));const x=h.node().getBBox(),y=d.append("line").attr("x1",0).attr("y1",i.padding+p+i.dividerMargin+x.height).attr("y2",i.padding+p+i.dividerMargin+x.height),u=d.append("text").attr("x",i.padding).attr("y",p+2*i.dividerMargin+x.height+i.textHeight).attr("fill","white").attr("class","classText");o=!0,e.methods.forEach((function(t){_(u,t,o,i),o=!1}));const b=d.node().getBBox();var w=" ";e.cssClasses.length>0&&(w+=e.cssClasses.join(" "));const m=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",b.width+2*i.padding).attr("height",b.height+i.padding+.5*i.dividerMargin).attr("class",w).node().getBBox().width;return s.node().childNodes.forEach((function(t){t.setAttribute("x",(m-t.getBBox().width)/2)})),e.tooltip&&s.insert("title").text(e.tooltip),g.attr("x2",m),y.attr("x2",m),r.width=m,r.height=b.height+i.padding+.5*i.dividerMargin,r},E=function(t){let e=t.id;return t.type&&(e+="<"+t.type+">"),e},A=function(t,e,i,n){f.debug("Rendering note ",e,i);const a=e.id,r={id:a,text:e.text,width:0,height:0},d=t.append("g").attr("id",a).attr("class","classGroup");let s=d.append("text").attr("y",i.textHeight+i.padding).attr("x",0);const o=JSON.parse(`"${e.text}"`).split("\n");o.forEach((function(t){f.debug(`Adding line: ${t}`),s.append("tspan").text(t).attr("class","title").attr("dy",i.textHeight)}));const l=d.node().getBBox(),c=d.insert("rect",":first-child").attr("x",0).attr("y",0).attr("width",l.width+2*i.padding).attr("height",l.height+o.length*i.textHeight+i.padding+.5*i.dividerMargin).node().getBBox().width;return s.node().childNodes.forEach((function(t){t.setAttribute("x",(c-t.getBBox().width)/2)})),r.width=c,r.height=l.height+o.length*i.textHeight+i.padding+.5*i.dividerMargin,r},M=function(t){let e="",i="",n="",a="",r=t.substring(0,1),d=t.substring(t.length-1,t.length);r.match(/[#+~-]/)&&(a=r);let s=/[\s\w)~]/;d.match(s)||(i=C(d));const o=""===a?0:1;let l=""===i?t.length:t.length-1;const c=(t=t.substring(o,l)).indexOf("("),p=t.indexOf(")");if(c>1&&p>c&&p<=t.length){let r=t.substring(0,c).trim();const d=t.substring(c+1,p);if(e=a+r+"("+N(d.trim())+")",p<t.length){let a=t.substring(p+1,p+2);""!==i||a.match(s)?n=t.substring(p+1).trim():(i=C(a),n=t.substring(p+2).trim()),""!==n&&(":"===n.charAt(0)&&(n=n.substring(1).trim()),n=" : "+N(n),e+=n)}}else e=a+N(t);return{displayText:e,cssStyle:i}},_=function(t,e,i,n){let a=M(e);const r=t.append("tspan").attr("x",n.padding).text(a.displayText);""!==a.cssStyle&&r.attr("style",a.cssStyle),i||r.attr("dy",n.textHeight)},C=function(t){switch(t){case"*":return"font-style:italic;";case"$":return"text-decoration:underline;";default:return""}},R={getClassTitleString:E,drawClass:P,drawEdge:O,drawNote:A,parseMember:M};export{M as p,R as s};