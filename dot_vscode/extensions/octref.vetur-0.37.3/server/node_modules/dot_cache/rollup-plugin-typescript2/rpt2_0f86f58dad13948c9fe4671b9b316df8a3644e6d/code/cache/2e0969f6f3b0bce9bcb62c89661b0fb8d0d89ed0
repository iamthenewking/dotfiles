{"code":"import { DiagnosticSeverity } from 'vscode-languageserver-types';\r\nimport { kebabCase } from 'lodash';\r\nimport { getSameTagInSet } from '../tagProviders/common';\r\nimport { normalizeAttributeNameToKebabCase } from './htmlCompletion';\r\nimport { VueVersion } from '../../../utils/vueVersion';\r\nexport function doPropValidation(document, htmlDocument, info, vueVersion) {\r\n    var _a;\r\n    const diagnostics = [];\r\n    const childComponentToProps = {};\r\n    (_a = info.componentInfo.childComponents) === null || _a === void 0 ? void 0 : _a.forEach(c => {\r\n        var _a;\r\n        if (c.info && c.info.componentInfo.props) {\r\n            childComponentToProps[c.name] = (_a = c.info) === null || _a === void 0 ? void 0 : _a.componentInfo.props.filter(el => el.required);\r\n        }\r\n    });\r\n    traverseNodes(htmlDocument.roots, n => {\r\n        if (n.tag) {\r\n            const foundTag = getSameTagInSet(childComponentToProps, n.tag);\r\n            if (foundTag) {\r\n                const d = generateDiagnostic(n, foundTag, document, vueVersion);\r\n                if (d) {\r\n                    diagnostics.push(d);\r\n                }\r\n            }\r\n        }\r\n    });\r\n    return diagnostics;\r\n}\r\nfunction traverseNodes(nodes, f) {\r\n    if (nodes.length === 0) {\r\n        return;\r\n    }\r\n    for (const node of nodes) {\r\n        f(node);\r\n        traverseNodes(node.children, f);\r\n    }\r\n}\r\nfunction generateDiagnostic(n, definedProps, document, vueVersion) {\r\n    // Ignore diagnostic when have `v-bind`, `v-bind:[key]`, `:[key]`, `v-bind.sync`\r\n    if (n.attributeNames.some(prop => prop === 'v-bind' || prop.startsWith('v-bind:[') || prop.startsWith(':[') || prop.startsWith('v-bind.'))) {\r\n        return undefined;\r\n    }\r\n    const vModelPropName = vueVersion === VueVersion.V30 ? 'modelValue' : 'value';\r\n    const seenProps = n.attributeNames.map(attr => {\r\n        var _a, _b;\r\n        return {\r\n            name: attr,\r\n            normalized: normalizeHtmlAttributeNameToKebabCaseAndReplaceVModel(attr, (_b = (_a = definedProps.find(prop => prop.isBoundToModel)) === null || _a === void 0 ? void 0 : _a.name) !== null && _b !== void 0 ? _b : vModelPropName)\r\n        };\r\n    });\r\n    const requiredProps = definedProps.map(prop => {\r\n        return Object.assign(Object.assign({}, prop), { normalized: kebabCase(prop.name) });\r\n    });\r\n    const missingProps = [];\r\n    requiredProps.forEach(requiredProp => {\r\n        if (!seenProps.map(s => s.normalized).includes(requiredProp.normalized)) {\r\n            missingProps.push(requiredProp);\r\n        }\r\n    });\r\n    if (missingProps.length === 0) {\r\n        return undefined;\r\n    }\r\n    return {\r\n        severity: missingProps.some(p => p.hasObjectValidator) ? DiagnosticSeverity.Error : DiagnosticSeverity.Warning,\r\n        message: `<${n.tag}> misses props: ${missingProps.map(p => p.normalized).join(', ')}\\n`,\r\n        range: {\r\n            start: document.positionAt(n.start),\r\n            end: document.positionAt(n.end)\r\n        }\r\n    };\r\n}\r\nfunction normalizeHtmlAttributeNameToKebabCaseAndReplaceVModel(attr, modelProp) {\r\n    // v-model.trim\r\n    if (!attr.startsWith('v-model:') && attr.startsWith('v-model')) {\r\n        return kebabCase(modelProp);\r\n    }\r\n    return normalizeAttributeNameToKebabCase(attr);\r\n}\r\n//# sourceMappingURL=vuePropValidation.js.map","references":["/Users/yoyo930021/git/vetur/server/src/services/vueInfoService.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-types/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-textdocument/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/parser/htmlParser.ts","/Users/yoyo930021/git/vetur/server/node_modules/@types/lodash/index.d.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/tagProviders/common.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlCompletion.ts","/Users/yoyo930021/git/vetur/server/src/utils/vueVersion.ts"],"map":"{\"version\":3,\"file\":\"vuePropValidation.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/modes/template/services/vuePropValidation.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/yoyo930021/git/vetur/server/node_modules/.cache/rollup-plugin-typescript2/placeholder/modes/template/services/vuePropValidation.d.ts","writeByteOrderMark":false,"text":"import { VueFileInfo } from '../../../services/vueInfoService';\r\nimport { Diagnostic } from 'vscode-languageserver-types';\r\nimport type { TextDocument } from 'vscode-languageserver-textdocument';\r\nimport { HTMLDocument } from '../parser/htmlParser';\r\nimport { VueVersion } from '../../../utils/vueVersion';\r\nexport declare function doPropValidation(document: TextDocument, htmlDocument: HTMLDocument, info: VueFileInfo, vueVersion: VueVersion): Diagnostic[];\r\n"}}
