{"code":"import { getLanguageModelCache } from '../../embeddedSupport/languageModelCache';\r\nimport { doComplete } from './services/htmlCompletion';\r\nimport { doHover } from './services/htmlHover';\r\nimport { findDocumentHighlights } from './services/htmlHighlighting';\r\nimport { findDocumentLinks } from './services/htmlLinks';\r\nimport { findDocumentSymbols } from './services/htmlSymbolsProvider';\r\nimport { htmlFormat } from './services/htmlFormat';\r\nimport { doESLintValidation, createLintEngine } from './services/htmlEslintValidation';\r\nimport { findDefinition } from './services/htmlDefinition';\r\nimport { getTagProviderSettings, getEnabledTagProviders } from './tagProviders';\r\nimport { getComponentInfoTagProvider } from './tagProviders/componentInfoTagProvider';\r\nimport { doPropValidation } from './services/vuePropValidation';\r\nimport { getFoldingRanges } from './services/htmlFolding';\r\nimport { isVCancellationRequested } from '../../utils/cancellationToken';\r\nexport class HTMLMode {\r\n    constructor(documentRegions, env, dependencyService, vueDocuments, autoImportSfcPlugin, vueInfoService) {\r\n        this.env = env;\r\n        this.dependencyService = dependencyService;\r\n        this.vueDocuments = vueDocuments;\r\n        this.autoImportSfcPlugin = autoImportSfcPlugin;\r\n        this.vueInfoService = vueInfoService;\r\n        this.tagProviderSettings = getTagProviderSettings(env.getPackagePath());\r\n        this.enabledTagProviders = getEnabledTagProviders(this.tagProviderSettings);\r\n        this.embeddedDocuments = getLanguageModelCache(10, 60, document => documentRegions.refreshAndGet(document).getSingleLanguageDocument('vue-html'));\r\n        this.lintEngine = createLintEngine(env.getVueVersion());\r\n    }\r\n    getId() {\r\n        return 'html';\r\n    }\r\n    async doValidation(document, cancellationToken) {\r\n        const diagnostics = [];\r\n        if (await isVCancellationRequested(cancellationToken)) {\r\n            return [];\r\n        }\r\n        if (this.env.getConfig().vetur.validation.templateProps) {\r\n            const info = this.vueInfoService ? this.vueInfoService.getInfo(document) : undefined;\r\n            const version = this.env.getVueVersion();\r\n            if (info && info.componentInfo.childComponents) {\r\n                diagnostics.push(...doPropValidation(document, this.vueDocuments.refreshAndGet(document), info, version));\r\n            }\r\n        }\r\n        if (await isVCancellationRequested(cancellationToken)) {\r\n            return diagnostics;\r\n        }\r\n        if (this.env.getConfig().vetur.validation.template) {\r\n            const embedded = this.embeddedDocuments.refreshAndGet(document);\r\n            diagnostics.push(...(await doESLintValidation(embedded, this.lintEngine)));\r\n        }\r\n        return diagnostics;\r\n    }\r\n    doComplete(document, position) {\r\n        const embedded = this.embeddedDocuments.refreshAndGet(document);\r\n        const tagProviders = [...this.enabledTagProviders];\r\n        const info = this.vueInfoService ? this.vueInfoService.getInfo(document) : undefined;\r\n        if (info && info.componentInfo.childComponents) {\r\n            tagProviders.push(getComponentInfoTagProvider(info.componentInfo.childComponents));\r\n        }\r\n        return doComplete(embedded, position, this.vueDocuments.refreshAndGet(embedded), tagProviders, this.env.getConfig().emmet, this.autoImportSfcPlugin.doComplete(document));\r\n    }\r\n    doHover(document, position) {\r\n        const embedded = this.embeddedDocuments.refreshAndGet(document);\r\n        const tagProviders = [...this.enabledTagProviders];\r\n        return doHover(embedded, position, this.vueDocuments.refreshAndGet(embedded), tagProviders);\r\n    }\r\n    findDocumentHighlight(document, position) {\r\n        return findDocumentHighlights(document, position, this.vueDocuments.refreshAndGet(document));\r\n    }\r\n    findDocumentLinks(document, documentContext) {\r\n        return findDocumentLinks(document, documentContext);\r\n    }\r\n    findDocumentSymbols(document) {\r\n        return findDocumentSymbols(document, this.vueDocuments.refreshAndGet(document));\r\n    }\r\n    format(document, range, formattingOptions) {\r\n        return htmlFormat(this.dependencyService, document, range, this.env.getConfig().vetur.format);\r\n    }\r\n    findDefinition(document, position) {\r\n        const embedded = this.embeddedDocuments.refreshAndGet(document);\r\n        const info = this.vueInfoService ? this.vueInfoService.getInfo(document) : undefined;\r\n        return findDefinition(embedded, position, this.vueDocuments.refreshAndGet(embedded), info);\r\n    }\r\n    getFoldingRanges(document) {\r\n        const embedded = this.embeddedDocuments.refreshAndGet(document);\r\n        return getFoldingRanges(embedded);\r\n    }\r\n    onDocumentChanged(filePath) {\r\n        if (filePath !== this.env.getPackagePath()) {\r\n            return;\r\n        }\r\n        // reload package\r\n        this.tagProviderSettings = getTagProviderSettings(this.env.getPackagePath());\r\n        this.enabledTagProviders = getEnabledTagProviders(this.tagProviderSettings);\r\n        this.lintEngine = createLintEngine(this.env.getVueVersion());\r\n    }\r\n    onDocumentRemoved(document) {\r\n        this.vueDocuments.onDocumentRemoved(document);\r\n    }\r\n    dispose() {\r\n        this.vueDocuments.dispose();\r\n    }\r\n}\r\n//# sourceMappingURL=htmlMode.js.map","references":["/Users/yoyo930021/git/vetur/server/node_modules/@types/lodash/index.d.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/languageModelCache.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-types/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-textdocument/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/languageModes.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/embeddedSupport.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/parser/htmlParser.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlCompletion.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlHover.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlHighlighting.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlLinks.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlSymbolsProvider.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlFormat.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlEslintValidation.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlDefinition.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/tagProviders/index.ts","/Users/yoyo930021/git/vetur/server/src/types.ts","/Users/yoyo930021/git/vetur/server/src/config.ts","/Users/yoyo930021/git/vetur/server/src/services/vueInfoService.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/tagProviders/componentInfoTagProvider.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/vuePropValidation.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/services/htmlFolding.ts","/Users/yoyo930021/git/vetur/server/src/services/dependencyService.ts","/Users/yoyo930021/git/vetur/server/src/utils/cancellationToken.ts","/Users/yoyo930021/git/vetur/server/src/modes/plugins/autoImportSfcPlugin.ts","/Users/yoyo930021/git/vetur/server/src/services/EnvironmentService.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/tagProviders/common.ts"],"map":"{\"version\":3,\"file\":\"htmlMode.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/modes/template/htmlMode.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/yoyo930021/git/vetur/server/node_modules/.cache/rollup-plugin-typescript2/placeholder/modes/template/htmlMode.d.ts","writeByteOrderMark":false,"text":"import { LanguageModelCache } from '../../embeddedSupport/languageModelCache';\r\nimport { Position, Range, FormattingOptions } from 'vscode-languageserver-types';\r\nimport type { TextDocument } from 'vscode-languageserver-textdocument';\r\nimport { LanguageMode } from '../../embeddedSupport/languageModes';\r\nimport { VueDocumentRegions } from '../../embeddedSupport/embeddedSupport';\r\nimport { HTMLDocument } from './parser/htmlParser';\r\nimport { DocumentContext } from '../../types';\r\nimport { VueInfoService } from '../../services/vueInfoService';\r\nimport { DependencyService } from '../../services/dependencyService';\r\nimport { VCancellationToken } from '../../utils/cancellationToken';\r\nimport { AutoImportSfcPlugin } from '../plugins/autoImportSfcPlugin';\r\nimport { EnvironmentService } from '../../services/EnvironmentService';\r\nexport declare class HTMLMode implements LanguageMode {\r\n    private env;\r\n    private dependencyService;\r\n    private vueDocuments;\r\n    private autoImportSfcPlugin;\r\n    private vueInfoService?;\r\n    private tagProviderSettings;\r\n    private enabledTagProviders;\r\n    private embeddedDocuments;\r\n    private lintEngine;\r\n    constructor(documentRegions: LanguageModelCache<VueDocumentRegions>, env: EnvironmentService, dependencyService: DependencyService, vueDocuments: LanguageModelCache<HTMLDocument>, autoImportSfcPlugin: AutoImportSfcPlugin, vueInfoService?: VueInfoService | undefined);\r\n    getId(): string;\r\n    doValidation(document: TextDocument, cancellationToken?: VCancellationToken): Promise<import(\"vscode-languageserver-types\").Diagnostic[]>;\r\n    doComplete(document: TextDocument, position: Position): import(\"vscode-languageserver-types\").CompletionList;\r\n    doHover(document: TextDocument, position: Position): import(\"vscode-languageserver-types\").Hover;\r\n    findDocumentHighlight(document: TextDocument, position: Position): import(\"vscode-languageserver-types\").DocumentHighlight[];\r\n    findDocumentLinks(document: TextDocument, documentContext: DocumentContext): import(\"vscode-languageserver-types\").DocumentLink[];\r\n    findDocumentSymbols(document: TextDocument): import(\"vscode-languageserver-types\").SymbolInformation[];\r\n    format(document: TextDocument, range: Range, formattingOptions: FormattingOptions): import(\"vscode-languageserver-types\").TextEdit[];\r\n    findDefinition(document: TextDocument, position: Position): import(\"vscode-languageserver-types\").Location[];\r\n    getFoldingRanges(document: TextDocument): import(\"vscode-languageserver-types\").FoldingRange[];\r\n    onDocumentChanged(filePath: string): void;\r\n    onDocumentRemoved(document: TextDocument): void;\r\n    dispose(): void;\r\n}\r\n"}}
