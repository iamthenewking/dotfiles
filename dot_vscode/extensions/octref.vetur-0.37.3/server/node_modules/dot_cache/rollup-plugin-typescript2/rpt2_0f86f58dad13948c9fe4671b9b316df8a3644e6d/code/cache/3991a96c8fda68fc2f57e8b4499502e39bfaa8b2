{"code":"import { Position, Range } from 'vscode-languageserver-types';\r\nimport { prettierPluginPugify } from '../../utils/prettier';\r\nimport { getFileFsPath } from '../../utils/paths';\r\nimport { findTokenAtPosition } from './languageService';\r\nimport { getLanguageModelCache } from '../../embeddedSupport/languageModelCache';\r\nimport { getTagDefinition } from '../template-common/tagDefinition';\r\nexport function getPugMode(env, dependencyService, documentRegions, vueInfoService) {\r\n    const embeddedDocuments = getLanguageModelCache(10, 60, document => documentRegions.refreshAndGet(document).getSingleLanguageDocument('pug'));\r\n    return {\r\n        getId: () => 'pug',\r\n        format(document, currRange, formattingOptions) {\r\n            if (env.getConfig().vetur.format.defaultFormatter['pug'] === 'none') {\r\n                return [];\r\n            }\r\n            const { value, range } = getValueAndRange(document, currRange);\r\n            return prettierPluginPugify(dependencyService, value, getFileFsPath(document.uri), 'pug', range, env.getConfig().vetur.format, false);\r\n        },\r\n        findDefinition(document, position) {\r\n            const embedded = embeddedDocuments.refreshAndGet(document);\r\n            const token = findTokenAtPosition(embedded.getText(), position);\r\n            if (!token || token.type !== 'tag') {\r\n                return [];\r\n            }\r\n            const info = vueInfoService === null || vueInfoService === void 0 ? void 0 : vueInfoService.getInfo(document);\r\n            if (!info) {\r\n                return [];\r\n            }\r\n            return getTagDefinition(info, token.val);\r\n        },\r\n        onDocumentRemoved() { },\r\n        dispose() { }\r\n    };\r\n}\r\nfunction getValueAndRange(document, currRange) {\r\n    let value = document.getText();\r\n    let range = currRange;\r\n    if (currRange) {\r\n        const startOffset = document.offsetAt(currRange.start);\r\n        const endOffset = document.offsetAt(currRange.end);\r\n        value = value.substring(startOffset, endOffset);\r\n    }\r\n    else {\r\n        range = Range.create(Position.create(0, 0), document.positionAt(value.length));\r\n    }\r\n    return { value, range };\r\n}\r\n//# sourceMappingURL=index.js.map","references":["/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-types/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-textdocument/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/languageModes.ts","/Users/yoyo930021/git/vetur/server/src/utils/prettier/index.ts","/Users/yoyo930021/git/vetur/server/src/config.ts","/Users/yoyo930021/git/vetur/server/src/utils/paths.ts","/Users/yoyo930021/git/vetur/server/src/services/dependencyService.ts","/Users/yoyo930021/git/vetur/server/src/services/EnvironmentService.ts","/Users/yoyo930021/git/vetur/server/src/modes/pug/languageService.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/languageModelCache.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/embeddedSupport.ts","/Users/yoyo930021/git/vetur/server/src/services/vueInfoService.ts","/Users/yoyo930021/git/vetur/server/src/modes/template-common/tagDefinition.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/modes/pug/index.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,MAAM,6BAA6B,CAAC;AAG9D,OAAO,EAAE,oBAAoB,EAAE,MAAM,sBAAsB,CAAC;AAE5D,OAAO,EAAE,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAGlD,OAAO,EAAE,mBAAmB,EAAE,MAAM,mBAAmB,CAAC;AACxD,OAAO,EAAE,qBAAqB,EAAsB,MAAM,0CAA0C,CAAC;AAGrG,OAAO,EAAE,gBAAgB,EAAE,MAAM,kCAAkC,CAAC;AAEpE,MAAM,UAAU,UAAU,CACxB,GAAuB,EACvB,iBAAoC,EACpC,eAAuD,EACvD,cAA+B;IAE/B,MAAM,iBAAiB,GAAG,qBAAqB,CAAe,EAAE,EAAE,EAAE,EAAE,QAAQ,CAAC,EAAE,CAC/E,eAAe,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC,yBAAyB,CAAC,KAAK,CAAC,CACzE,CAAC;IAEF,OAAO;QACL,KAAK,EAAE,GAAG,EAAE,CAAC,KAAK;QAClB,MAAM,CAAC,QAAQ,EAAE,SAAS,EAAE,iBAAiB;YAC3C,IAAI,GAAG,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,KAAK,MAAM,EAAE;gBACnE,OAAO,EAAE,CAAC;aACX;YAED,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,gBAAgB,CAAC,QAAQ,EAAE,SAAS,CAAC,CAAC;YAE/D,OAAO,oBAAoB,CACzB,iBAAiB,EACjB,KAAK,EACL,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,EAC3B,KAAK,EACL,KAAK,EACL,GAAG,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC,MAAyB,EAC/C,KAAK,CACN,CAAC;QACJ,CAAC;QACD,cAAc,CAAC,QAAQ,EAAE,QAAQ;YAC/B,MAAM,QAAQ,GAAG,iBAAiB,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;YAE3D,MAAM,KAAK,GAAG,mBAAmB,CAAC,QAAQ,CAAC,OAAO,EAAE,EAAE,QAAQ,CAAC,CAAC;YAChE,IAAI,CAAC,KAAK,IAAI,KAAK,CAAC,IAAI,KAAK,KAAK,EAAE;gBAClC,OAAO,EAAE,CAAC;aACX;YAED,MAAM,IAAI,GAAG,cAAc,aAAd,cAAc,uBAAd,cAAc,CAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;YAC/C,IAAI,CAAC,IAAI,EAAE;gBACT,OAAO,EAAE,CAAC;aACX;YAED,OAAO,gBAAgB,CAAC,IAAI,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC;QAC3C,CAAC;QACD,iBAAiB,KAAI,CAAC;QACtB,OAAO,KAAI,CAAC;KACb,CAAC;AACJ,CAAC;AAED,SAAS,gBAAgB,CAAC,QAAsB,EAAE,SAAgB;IAChE,IAAI,KAAK,GAAG,QAAQ,CAAC,OAAO,EAAE,CAAC;IAC/B,IAAI,KAAK,GAAG,SAAS,CAAC;IAEtB,IAAI,SAAS,EAAE;QACb,MAAM,WAAW,GAAG,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACvD,MAAM,SAAS,GAAG,QAAQ,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;QACnD,KAAK,GAAG,KAAK,CAAC,SAAS,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC;KACjD;SAAM;QACL,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC;KAChF;IACD,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC;AAC1B,CAAC\"}","dts":{"name":"/Users/yoyo930021/git/vetur/server/node_modules/.cache/rollup-plugin-typescript2/placeholder/modes/pug/index.d.ts","writeByteOrderMark":false,"text":"import { LanguageMode } from '../../embeddedSupport/languageModes';\r\nimport { DependencyService } from '../../services/dependencyService';\r\nimport { EnvironmentService } from '../../services/EnvironmentService';\r\nimport { LanguageModelCache } from '../../embeddedSupport/languageModelCache';\r\nimport { VueDocumentRegions } from '../../embeddedSupport/embeddedSupport';\r\nimport { VueInfoService } from '../../services/vueInfoService';\r\nexport declare function getPugMode(env: EnvironmentService, dependencyService: DependencyService, documentRegions: LanguageModelCache<VueDocumentRegions>, vueInfoService?: VueInfoService): LanguageMode;\r\n"}}
