{"code":"import { getLanguageModelCache } from '../../embeddedSupport/languageModelCache';\r\nimport { HTMLMode } from './htmlMode';\r\nimport { VueInterpolationMode } from './interpolationMode';\r\nimport { parseHTMLDocument } from './parser/htmlParser';\r\nexport class VueHTMLMode {\r\n    constructor(tsModule, serviceHost, env, documentRegions, autoImportSfcPlugin, dependencyService, vueInfoService) {\r\n        const vueDocuments = getLanguageModelCache(10, 60, document => parseHTMLDocument(document));\r\n        this.htmlMode = new HTMLMode(documentRegions, env, dependencyService, vueDocuments, autoImportSfcPlugin, vueInfoService);\r\n        this.vueInterpolationMode = new VueInterpolationMode(documentRegions, tsModule, serviceHost, env, vueDocuments, vueInfoService);\r\n        this.autoImportSfcPlugin = autoImportSfcPlugin;\r\n    }\r\n    getId() {\r\n        return 'vue-html';\r\n    }\r\n    queryVirtualFileInfo(fileName, currFileText) {\r\n        return this.vueInterpolationMode.queryVirtualFileInfo(fileName, currFileText);\r\n    }\r\n    async doValidation(document, cancellationToken) {\r\n        return Promise.all([\r\n            this.vueInterpolationMode.doValidation(document, cancellationToken),\r\n            this.htmlMode.doValidation(document, cancellationToken)\r\n        ]).then(result => [...result[0], ...result[1]]);\r\n    }\r\n    doComplete(document, position) {\r\n        const htmlList = this.htmlMode.doComplete(document, position);\r\n        const intList = this.vueInterpolationMode.doComplete(document, position);\r\n        return {\r\n            isIncomplete: htmlList.isIncomplete || intList.isIncomplete,\r\n            items: htmlList.items.concat(intList.items)\r\n        };\r\n    }\r\n    doResolve(document, item) {\r\n        if (this.autoImportSfcPlugin.isMyResolve(item)) {\r\n            return this.autoImportSfcPlugin.doResolve(document, item);\r\n        }\r\n        return this.vueInterpolationMode.doResolve(document, item);\r\n    }\r\n    doHover(document, position) {\r\n        // Return concatenated results from both vueInterpolationMode and htmlMode.\r\n        const interpolationHover = this.vueInterpolationMode.doHover(document, position);\r\n        let markdownContent = '';\r\n        if (interpolationHover.contents.length > 0) {\r\n            for (const content of interpolationHover.contents) {\r\n                if (typeof content === 'string') {\r\n                    markdownContent += `${content}\\n`;\r\n                }\r\n                else {\r\n                    markdownContent += `\\`\\`\\`${content.language}\\n${content.value}\\n\\`\\`\\`\\n`;\r\n                }\r\n            }\r\n        }\r\n        const htmlResult = this.htmlMode.doHover(document, position);\r\n        if (htmlResult.contents && Array.isArray(htmlResult.contents)) {\r\n            for (const content of htmlResult.contents) {\r\n                if (typeof content === 'string') {\r\n                    markdownContent += `${content}\\n`;\r\n                }\r\n                else {\r\n                    markdownContent += `\\`\\`\\`${content.language}\\n${content.value}\\n\\`\\`\\`\\n`;\r\n                }\r\n            }\r\n        }\r\n        else if (typeof htmlResult.contents === 'string') {\r\n            markdownContent += `${htmlResult.contents}\\n`;\r\n        }\r\n        else if ('kind' in htmlResult.contents) {\r\n            markdownContent += `${htmlResult.contents.value}\\n`;\r\n        }\r\n        else {\r\n            markdownContent += `\\`\\`\\`${htmlResult.contents.language}\\n${htmlResult.contents.value}\\n\\`\\`\\`\\n`;\r\n        }\r\n        return {\r\n            contents: { kind: 'markdown', value: markdownContent },\r\n            range: interpolationHover.range || htmlResult.range\r\n        };\r\n    }\r\n    findDocumentHighlight(document, position) {\r\n        return this.htmlMode.findDocumentHighlight(document, position);\r\n    }\r\n    findDocumentLinks(document, documentContext) {\r\n        return this.htmlMode.findDocumentLinks(document, documentContext);\r\n    }\r\n    findDocumentSymbols(document) {\r\n        return this.htmlMode.findDocumentSymbols(document);\r\n    }\r\n    format(document, range, formattingOptions) {\r\n        return this.htmlMode.format(document, range, formattingOptions);\r\n    }\r\n    findReferences(document, position) {\r\n        return this.vueInterpolationMode.findReferences(document, position);\r\n    }\r\n    findDefinition(document, position) {\r\n        const htmlDefinition = this.htmlMode.findDefinition(document, position);\r\n        return htmlDefinition.length > 0 ? htmlDefinition : this.vueInterpolationMode.findDefinition(document, position);\r\n    }\r\n    getFoldingRanges(document) {\r\n        return this.htmlMode.getFoldingRanges(document);\r\n    }\r\n    onDocumentRemoved(document) {\r\n        this.htmlMode.onDocumentRemoved(document);\r\n    }\r\n    dispose() {\r\n        this.htmlMode.dispose();\r\n    }\r\n}\r\n//# sourceMappingURL=index.js.map","references":["/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-types/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-textdocument/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/embeddedSupport.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/languageModelCache.ts","/Users/yoyo930021/git/vetur/server/src/embeddedSupport/languageModes.ts","/Users/yoyo930021/git/vetur/server/src/services/vueInfoService.ts","/Users/yoyo930021/git/vetur/server/src/types.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/htmlMode.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/interpolationMode.ts","/Users/yoyo930021/git/vetur/server/src/services/typescriptService/serviceHost.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/parser/htmlParser.ts","/Users/yoyo930021/git/vetur/server/src/services/dependencyService.ts","/Users/yoyo930021/git/vetur/server/src/utils/cancellationToken.ts","/Users/yoyo930021/git/vetur/server/src/modes/plugins/autoImportSfcPlugin.ts","/Users/yoyo930021/git/vetur/server/src/services/EnvironmentService.ts"],"map":"{\"version\":3,\"file\":\"index.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../src/modes/template/index.ts\"],\"names\":[],\"mappings\":\"AAGA,OAAO,EAAsB,qBAAqB,EAAE,MAAM,0CAA0C,CAAC;AAIrG,OAAO,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAC;AACtC,OAAO,EAAE,oBAAoB,EAAE,MAAM,qBAAqB,CAAC;AAE3D,OAAO,EAAgB,iBAAiB,EAAE,MAAM,qBAAqB,CAAC;AAQtE,MAAM,OAAO,WAAW;IAKtB,YACE,QAAsC,EACtC,WAAyB,EACzB,GAAuB,EACvB,eAAoC,EACpC,mBAAwC,EACxC,iBAAoC,EACpC,cAA+B;QAE/B,MAAM,YAAY,GAAG,qBAAqB,CAAe,EAAE,EAAE,EAAE,EAAE,QAAQ,CAAC,EAAE,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC,CAAC;QAC1G,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,CAC1B,eAAe,EACf,GAAG,EACH,iBAAiB,EACjB,YAAY,EACZ,mBAAmB,EACnB,cAAc,CACf,CAAC;QACF,IAAI,CAAC,oBAAoB,GAAG,IAAI,oBAAoB,CAClD,eAAe,EACf,QAAQ,EACR,WAAW,EACX,GAAG,EACH,YAAY,EACZ,cAAc,CACf,CAAC;QACF,IAAI,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;IACjD,CAAC;IACD,KAAK;QACH,OAAO,UAAU,CAAC;IACpB,CAAC;IACD,oBAAoB,CAAC,QAAgB,EAAE,YAAoB;QACzD,OAAO,IAAI,CAAC,oBAAoB,CAAC,oBAAoB,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC;IAChF,CAAC;IACD,KAAK,CAAC,YAAY,CAAC,QAAsB,EAAE,iBAAsC;QAC/E,OAAO,OAAO,CAAC,GAAG,CAAC;YACjB,IAAI,CAAC,oBAAoB,CAAC,YAAY,CAAC,QAAQ,EAAE,iBAAiB,CAAC;YACnE,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,QAAQ,EAAE,iBAAiB,CAAC;SACxD,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAClD,CAAC;IACD,UAAU,CAAC,QAAsB,EAAE,QAAkB;QACnD,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAC9D,MAAM,OAAO,GAAG,IAAI,CAAC,oBAAoB,CAAC,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QACzE,OAAO;YACL,YAAY,EAAE,QAAQ,CAAC,YAAY,IAAI,OAAO,CAAC,YAAY;YAC3D,KAAK,EAAE,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC;SAC5C,CAAC;IACJ,CAAC;IACD,SAAS,CAAC,QAAsB,EAAE,IAAoB;QACpD,IAAI,IAAI,CAAC,mBAAmB,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE;YAC9C,OAAO,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;SAC3D;QACD,OAAO,IAAI,CAAC,oBAAoB,CAAC,SAAS,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;IAC7D,CAAC;IACD,OAAO,CAAC,QAAsB,EAAE,QAAkB;QAChD,2EAA2E;QAC3E,MAAM,kBAAkB,GAAG,IAAI,CAAC,oBAAoB,CAAC,OAAO,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QACjF,IAAI,eAAe,GAAG,EAAE,CAAC;QACzB,IAAI,kBAAkB,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;YAC1C,KAAK,MAAM,OAAO,IAAI,kBAAkB,CAAC,QAAQ,EAAE;gBACjD,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;oBAC/B,eAAe,IAAI,GAAG,OAAO,IAAI,CAAC;iBACnC;qBAAM;oBACL,eAAe,IAAI,SAAS,OAAO,CAAC,QAAQ,KAAK,OAAO,CAAC,KAAK,YAAY,CAAC;iBAC5E;aACF;SACF;QACD,MAAM,UAAU,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAC7D,IAAI,UAAU,CAAC,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE;YAC7D,KAAK,MAAM,OAAO,IAAI,UAAU,CAAC,QAAQ,EAAE;gBACzC,IAAI,OAAO,OAAO,KAAK,QAAQ,EAAE;oBAC/B,eAAe,IAAI,GAAG,OAAO,IAAI,CAAC;iBACnC;qBAAM;oBACL,eAAe,IAAI,SAAS,OAAO,CAAC,QAAQ,KAAK,OAAO,CAAC,KAAK,YAAY,CAAC;iBAC5E;aACF;SACF;aAAM,IAAI,OAAO,UAAU,CAAC,QAAQ,KAAK,QAAQ,EAAE;YAClD,eAAe,IAAI,GAAG,UAAU,CAAC,QAAQ,IAAI,CAAC;SAC/C;aAAM,IAAI,MAAM,IAAI,UAAU,CAAC,QAAQ,EAAE;YACxC,eAAe,IAAI,GAAG,UAAU,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC;SACrD;aAAM;YACL,eAAe,IAAI,SAAS,UAAU,CAAC,QAAQ,CAAC,QAAQ,KAAK,UAAU,CAAC,QAAQ,CAAC,KAAK,YAAY,CAAC;SACpG;QACD,OAAO;YACL,QAAQ,EAAE,EAAE,IAAI,EAAE,UAAU,EAAE,KAAK,EAAE,eAAe,EAAE;YACtD,KAAK,EAAE,kBAAkB,CAAC,KAAK,IAAI,UAAU,CAAC,KAAK;SACpD,CAAC;IACJ,CAAC;IACD,qBAAqB,CAAC,QAAsB,EAAE,QAAkB;QAC9D,OAAO,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;IACjE,CAAC;IACD,iBAAiB,CAAC,QAAsB,EAAE,eAAgC;QACxE,OAAO,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC;IACpE,CAAC;IACD,mBAAmB,CAAC,QAAsB;QACxC,OAAO,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CAAC;IACrD,CAAC;IACD,MAAM,CAAC,QAAsB,EAAE,KAAY,EAAE,iBAAoC;QAC/E,OAAO,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,EAAE,KAAK,EAAE,iBAAiB,CAAC,CAAC;IAClE,CAAC;IACD,cAAc,CAAC,QAAsB,EAAE,QAAkB;QACvD,OAAO,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;IACtE,CAAC;IACD,cAAc,CAAC,QAAsB,EAAE,QAAkB;QACvD,MAAM,cAAc,GAAG,IAAI,CAAC,QAAQ,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;QAExE,OAAO,cAAc,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;IACnH,CAAC;IACD,gBAAgB,CAAC,QAAsB;QACrC,OAAO,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC;IAClD,CAAC;IACD,iBAAiB,CAAC,QAAsB;QACtC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;IAC5C,CAAC;IACD,OAAO;QACL,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,CAAC;IAC1B,CAAC;CACF\"}","dts":{"name":"/Users/yoyo930021/git/vetur/server/node_modules/.cache/rollup-plugin-typescript2/placeholder/modes/template/index.d.ts","writeByteOrderMark":false,"text":"import { FormattingOptions, Position, Range, Hover, Location, CompletionItem } from 'vscode-languageserver-types';\r\nimport type { TextDocument } from 'vscode-languageserver-textdocument';\r\nimport { VueDocumentRegions } from '../../embeddedSupport/embeddedSupport';\r\nimport { LanguageModelCache } from '../../embeddedSupport/languageModelCache';\r\nimport { LanguageMode } from '../../embeddedSupport/languageModes';\r\nimport { VueInfoService } from '../../services/vueInfoService';\r\nimport { DocumentContext } from '../../types';\r\nimport { IServiceHost } from '../../services/typescriptService/serviceHost';\r\nimport { DependencyService, RuntimeLibrary } from '../../services/dependencyService';\r\nimport { VCancellationToken } from '../../utils/cancellationToken';\r\nimport { AutoImportSfcPlugin } from '../plugins/autoImportSfcPlugin';\r\nimport { EnvironmentService } from '../../services/EnvironmentService';\r\ntype DocumentRegionCache = LanguageModelCache<VueDocumentRegions>;\r\nexport declare class VueHTMLMode implements LanguageMode {\r\n    private htmlMode;\r\n    private vueInterpolationMode;\r\n    private autoImportSfcPlugin;\r\n    constructor(tsModule: RuntimeLibrary['typescript'], serviceHost: IServiceHost, env: EnvironmentService, documentRegions: DocumentRegionCache, autoImportSfcPlugin: AutoImportSfcPlugin, dependencyService: DependencyService, vueInfoService?: VueInfoService);\r\n    getId(): string;\r\n    queryVirtualFileInfo(fileName: string, currFileText: string): {\r\n        source: string;\r\n        sourceMapNodesString: string;\r\n    };\r\n    doValidation(document: TextDocument, cancellationToken?: VCancellationToken): Promise<import(\"vscode-languageserver-types\").Diagnostic[]>;\r\n    doComplete(document: TextDocument, position: Position): {\r\n        isIncomplete: boolean;\r\n        items: CompletionItem[];\r\n    };\r\n    doResolve(document: TextDocument, item: CompletionItem): CompletionItem;\r\n    doHover(document: TextDocument, position: Position): Hover;\r\n    findDocumentHighlight(document: TextDocument, position: Position): import(\"vscode-languageserver-types\").DocumentHighlight[];\r\n    findDocumentLinks(document: TextDocument, documentContext: DocumentContext): import(\"vscode-languageserver-types\").DocumentLink[];\r\n    findDocumentSymbols(document: TextDocument): import(\"vscode-languageserver-types\").SymbolInformation[];\r\n    format(document: TextDocument, range: Range, formattingOptions: FormattingOptions): import(\"vscode-languageserver-types\").TextEdit[];\r\n    findReferences(document: TextDocument, position: Position): Location[];\r\n    findDefinition(document: TextDocument, position: Position): Location[];\r\n    getFoldingRanges(document: TextDocument): import(\"vscode-languageserver-types\").FoldingRange[];\r\n    onDocumentRemoved(document: TextDocument): void;\r\n    dispose(): void;\r\n}\r\nexport {};\r\n"}}
