{"code":"import { SymbolInformation, SymbolKind, Range, Position } from 'vscode-languageserver-types';\r\nimport { buildAst, flattenAndFilterAst, isAtRuleNode, isFunctionNode, isSelectorCallNode, isSelectorNode, isVariableNode } from './parser';\r\nimport _ from 'lodash';\r\n/**\r\n * Generates hash for symbol for comparison with other symbols\r\n * @param {SymbolInformation} symbol\r\n * @return {String}\r\n */\r\nfunction _buildHashFromSymbol(symbol) {\r\n    return `${symbol.kind}_${symbol.name}_${symbol.location.range.start.line}_${symbol.location.range.end.line}`;\r\n}\r\n/**\r\n * Removes useless characters from symbol name\r\n * @param {String} name\r\n * @return String\r\n */\r\nfunction prepareName(name) {\r\n    return name.replace(/\\{|\\}/g, '').trim();\r\n}\r\n/**\r\n * Handler for variables\r\n * @param {Object} node\r\n * @param {String[]} text - text editor content splitted by lines\r\n * @return {SymbolInformation}\r\n */\r\nfunction _variableSymbol(node, text) {\r\n    const name = node.name;\r\n    const lineno = Number(node.val.lineno) - 1;\r\n    const column = Math.max(text[lineno].indexOf(name), 0);\r\n    const range = Range.create(lineno, column, lineno, column + name.length);\r\n    return SymbolInformation.create(name, SymbolKind.Variable, range);\r\n}\r\n/**\r\n * Handler for function\r\n * @param {Object} node\r\n * @param {String[]} text - text editor content splitted by lines\r\n * @return {SymbolInformation}\r\n */\r\nfunction _functionSymbol(node, text) {\r\n    const name = node.name;\r\n    const lineno = Number(node.val.lineno) - 1;\r\n    const column = Math.max(text[lineno].indexOf(name), 0);\r\n    const posStart = Position.create(lineno, column);\r\n    const posEnd = Position.create(lineno, column + name.length);\r\n    const range = Range.create(posStart, posEnd);\r\n    return SymbolInformation.create(name, SymbolKind.Function, range);\r\n}\r\n/**\r\n * Handler for selectors\r\n * @param {Object} node\r\n * @param {String[]} text - text editor content splitted by lines\r\n * @return {SymbolInformation}\r\n */\r\nfunction _selectorSymbol(node, text) {\r\n    const firstSegment = node.segments[0];\r\n    const name = firstSegment.string\r\n        ? node.segments.map(s => s.string).join('')\r\n        : firstSegment.nodes.map(s => s.name).join('');\r\n    const lineno = Number(firstSegment.lineno) - 1;\r\n    const column = node.column - 1;\r\n    const posStart = Position.create(lineno, column);\r\n    const posEnd = Position.create(lineno, column + name.length);\r\n    const range = Range.create(posStart, posEnd);\r\n    return SymbolInformation.create(name, SymbolKind.Class, range);\r\n}\r\n/**\r\n * Handler for selector call symbols\r\n * @param {Object} node\r\n * @param {String[]} text - text editor content splitted by lines\r\n * @return {SymbolInformation}\r\n */\r\nfunction _selectorCallSymbol(node, text) {\r\n    const lineno = Number(node.lineno) - 1;\r\n    const name = prepareName(text[lineno]);\r\n    const column = Math.max(text[lineno].indexOf(name), 0);\r\n    const posStart = Position.create(lineno, column);\r\n    const posEnd = Position.create(lineno, column + name.length);\r\n    return SymbolInformation.create(name, SymbolKind.Class, Range.create(posStart, posEnd));\r\n}\r\n/**\r\n * Handler for at rules\r\n * @param {Object} node\r\n * @param {String[]} text - text editor content splitted by lines\r\n * @return {SymbolInformation}\r\n */\r\nfunction _atRuleSymbol(node, text) {\r\n    const lineno = Number(node.lineno) - 1;\r\n    const name = prepareName(text[lineno]);\r\n    const column = Math.max(text[lineno].indexOf(name), 0);\r\n    const posStart = Position.create(lineno, column);\r\n    const posEnd = Position.create(lineno, column + name.length);\r\n    return SymbolInformation.create(name, SymbolKind.Namespace, Range.create(posStart, posEnd));\r\n}\r\n/**\r\n * Iterates through raw symbols and choose appropriate handler for each one\r\n * @param {Array} rawSymbols\r\n * @param {String[]} text - text editor content splitted by lines\r\n * @return {SymbolInformation[]}\r\n */\r\nfunction processRawSymbols(rawSymbols, text) {\r\n    return _.compact(rawSymbols.map(symNode => {\r\n        if (isVariableNode(symNode)) {\r\n            return _variableSymbol(symNode, text);\r\n        }\r\n        if (isFunctionNode(symNode)) {\r\n            return _functionSymbol(symNode, text);\r\n        }\r\n        if (isSelectorNode(symNode)) {\r\n            return _selectorSymbol(symNode, text);\r\n        }\r\n        if (isSelectorCallNode(symNode)) {\r\n            return _selectorCallSymbol(symNode, text);\r\n        }\r\n        if (isAtRuleNode(symNode)) {\r\n            return _atRuleSymbol(symNode, text);\r\n        }\r\n    }));\r\n}\r\nexport function provideDocumentSymbols(document) {\r\n    const text = document.getText();\r\n    const ast = buildAst(text);\r\n    if (!ast) {\r\n        return [];\r\n    }\r\n    const rawSymbols = _.compact(flattenAndFilterAst(ast));\r\n    const symbolInfos = processRawSymbols(rawSymbols, text.split('\\n'));\r\n    return _.uniqBy(symbolInfos, _buildHashFromSymbol);\r\n}\r\n//# sourceMappingURL=symbols-finder.js.map","references":["/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-types/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-textdocument/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/src/modes/style/stylus/parser.ts","/Users/yoyo930021/git/vetur/server/node_modules/@types/lodash/index.d.ts"],"map":"{\"version\":3,\"file\":\"symbols-finder.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/modes/style/stylus/symbols-finder.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/yoyo930021/git/vetur/server/node_modules/.cache/rollup-plugin-typescript2/placeholder/modes/style/stylus/symbols-finder.d.ts","writeByteOrderMark":false,"text":"import { SymbolInformation } from 'vscode-languageserver-types';\r\nimport type { TextDocument } from 'vscode-languageserver-textdocument';\r\nexport declare function provideDocumentSymbols(document: TextDocument): SymbolInformation[];\r\n"}}
