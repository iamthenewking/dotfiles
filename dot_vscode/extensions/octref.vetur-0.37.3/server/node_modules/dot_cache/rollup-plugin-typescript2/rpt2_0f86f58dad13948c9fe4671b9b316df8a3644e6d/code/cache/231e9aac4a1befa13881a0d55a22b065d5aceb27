{"code":"import _ from 'lodash';\r\nimport { Range, Position } from 'vscode-languageserver-types';\r\nimport { html as htmlBeautify } from 'js-beautify';\r\nimport { getFileFsPath } from '../../../utils/paths';\r\nimport { prettierify } from '../../../utils/prettier';\r\nconst TEMPLATE_HEAD = '<template>';\r\nconst TEMPLATE_TAIL = '</template>';\r\nexport function htmlFormat(dependencyService, document, currRange, vlsFormatConfig) {\r\n    if (vlsFormatConfig.defaultFormatter.html === 'none') {\r\n        return [];\r\n    }\r\n    const { value, range } = getValueAndRange(document, currRange);\r\n    const originalSource = TEMPLATE_HEAD + value + TEMPLATE_TAIL;\r\n    let beautifiedHtml;\r\n    if (vlsFormatConfig.defaultFormatter.html === 'prettyhtml') {\r\n        beautifiedHtml = formatWithPrettyHtml(dependencyService, getFileFsPath(document.uri), originalSource, vlsFormatConfig);\r\n    }\r\n    else if (vlsFormatConfig.defaultFormatter.html === 'prettier') {\r\n        const prettierResult = formatWithPrettier(dependencyService, originalSource, getFileFsPath(document.uri), currRange, vlsFormatConfig, false);\r\n        if (prettierResult[0] && prettierResult[0].newText) {\r\n            beautifiedHtml = prettierResult[0].newText.trim();\r\n        }\r\n        else {\r\n            beautifiedHtml = originalSource;\r\n        }\r\n    }\r\n    else {\r\n        beautifiedHtml = formatWithJsBeautify(originalSource, vlsFormatConfig);\r\n    }\r\n    const wrappedHtml = beautifiedHtml.substring(TEMPLATE_HEAD.length, beautifiedHtml.length - TEMPLATE_TAIL.length);\r\n    return [\r\n        {\r\n            range,\r\n            newText: wrappedHtml\r\n        }\r\n    ];\r\n}\r\nfunction formatWithPrettyHtml(dependencyService, fileFsPath, input, vlsFormatConfig) {\r\n    const prettier = dependencyService.get('prettier', fileFsPath).module;\r\n    const prettierrcOptions = prettier.resolveConfig.sync(fileFsPath, { useCache: false }) || null;\r\n    const prettyhtml = dependencyService.get('@starptech/prettyhtml', fileFsPath).module;\r\n    const result = prettyhtml(input, getPrettyHtmlOptions(prettierrcOptions, vlsFormatConfig));\r\n    return result.contents.trim();\r\n}\r\nfunction formatWithJsBeautify(input, vlsFormatConfig) {\r\n    const htmlFormattingOptions = _.assign(defaultHtmlOptions, {\r\n        indent_with_tabs: vlsFormatConfig.options.useTabs,\r\n        indent_size: vlsFormatConfig.options.tabSize\r\n    }, vlsFormatConfig.defaultFormatterOptions['js-beautify-html'], { end_with_newline: false });\r\n    return htmlBeautify(input, htmlFormattingOptions);\r\n}\r\nfunction formatWithPrettier(dependencyService, code, fileFsPath, range, vlsFormatConfig, initialIndent) {\r\n    return prettierify(dependencyService, code, fileFsPath, 'vue', range, vlsFormatConfig, initialIndent);\r\n}\r\nfunction getPrettyHtmlOptions(prettierrcOptions, vlsFormatConfig) {\r\n    const fromVls = {\r\n        useTabs: vlsFormatConfig.options.useTabs,\r\n        tabWidth: vlsFormatConfig.options.tabSize\r\n    };\r\n    const fromPrettier = {};\r\n    if (prettierrcOptions) {\r\n        fromPrettier.useTabs = prettierrcOptions.useTabs;\r\n        fromPrettier.tabWidth = prettierrcOptions.tabWidth;\r\n        fromPrettier.printWidth = prettierrcOptions.printWidth;\r\n    }\r\n    return Object.assign(Object.assign(Object.assign(Object.assign({}, fromVls), fromPrettier), { usePrettier: true, prettier: Object.assign({}, prettierrcOptions) }), vlsFormatConfig.defaultFormatterOptions['prettyhtml']);\r\n}\r\nfunction getValueAndRange(document, currRange) {\r\n    let value = document.getText();\r\n    let range = currRange;\r\n    if (currRange) {\r\n        const startOffset = document.offsetAt(currRange.start);\r\n        const endOffset = document.offsetAt(currRange.end);\r\n        value = value.substring(startOffset, endOffset);\r\n    }\r\n    else {\r\n        range = Range.create(Position.create(0, 0), document.positionAt(value.length));\r\n    }\r\n    return { value, range };\r\n}\r\nconst defaultHtmlOptions = {\r\n    end_with_newline: false,\r\n    indent_char: ' ',\r\n    indent_handlebars: false,\r\n    indent_inner_html: false,\r\n    indent_scripts: 'keep',\r\n    indent_size: 2,\r\n    indent_with_tabs: false,\r\n    max_preserve_newlines: 1,\r\n    preserve_newlines: true,\r\n    unformatted: [],\r\n    wrap_line_length: 0,\r\n    wrap_attributes: 'force-expand-multiline'\r\n    // Wrap attributes to new lines [auto|force|force-aligned|force-expand-multiline] [\"auto\"]\r\n};\r\n//# sourceMappingURL=htmlFormat.js.map","references":["/Users/yoyo930021/git/vetur/server/node_modules/@types/lodash/index.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-types/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-textdocument/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/@types/js-beautify/index.d.ts","/Users/yoyo930021/git/vetur/server/src/utils/paths.ts","/Users/yoyo930021/git/vetur/server/src/config.ts","/Users/yoyo930021/git/vetur/server/src/utils/prettier/index.ts","/Users/yoyo930021/git/vetur/server/src/services/dependencyService.ts","/Users/yoyo930021/git/vetur/server/node_modules/@types/prettier/index.d.ts"],"map":"{\"version\":3,\"file\":\"htmlFormat.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/modes/template/services/htmlFormat.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/yoyo930021/git/vetur/server/node_modules/.cache/rollup-plugin-typescript2/placeholder/modes/template/services/htmlFormat.d.ts","writeByteOrderMark":false,"text":"import { Range, TextEdit } from 'vscode-languageserver-types';\r\nimport type { TextDocument } from 'vscode-languageserver-textdocument';\r\nimport { VLSFormatConfig } from '../../../config';\r\nimport { DependencyService } from '../../../services/dependencyService';\r\nexport declare function htmlFormat(dependencyService: DependencyService, document: TextDocument, currRange: Range, vlsFormatConfig: VLSFormatConfig): TextEdit[];\r\n"}}
