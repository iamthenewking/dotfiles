{"code":"import { HtmlTokenType, createScanner } from '../parser/htmlScanner';\r\nimport { NULL_HOVER } from '../../nullMode';\r\nimport { toMarkupContent } from '../../../utils/strings';\r\nconst TRIVIAL_TOKEN = [HtmlTokenType.StartTagOpen, HtmlTokenType.EndTagOpen, HtmlTokenType.Whitespace];\r\nexport function doHover(document, position, htmlDocument, tagProviders) {\r\n    const offset = document.offsetAt(position);\r\n    const node = htmlDocument.findNodeAt(offset);\r\n    if (!node || !node.tag) {\r\n        return NULL_HOVER;\r\n    }\r\n    function getTagHover(tag, range, open) {\r\n        tag = tag.toLowerCase();\r\n        for (const provider of tagProviders) {\r\n            let hover = null;\r\n            provider.collectTags((t, documentation) => {\r\n                if (t !== tag) {\r\n                    return;\r\n                }\r\n                hover = { contents: toMarkupContent(documentation), range };\r\n            });\r\n            if (hover) {\r\n                return hover;\r\n            }\r\n        }\r\n        return NULL_HOVER;\r\n    }\r\n    function getAttributeHover(tag, attribute, range) {\r\n        for (const provider of tagProviders) {\r\n            let hover = null;\r\n            provider.collectAttributes(tag, (attr, type, documentation) => {\r\n                if (attribute !== attr) {\r\n                    return;\r\n                }\r\n                hover = { contents: toMarkupContent(documentation), range };\r\n            });\r\n            if (hover) {\r\n                return hover;\r\n            }\r\n        }\r\n        return NULL_HOVER;\r\n    }\r\n    const inEndTag = node.endTagStart && offset >= node.endTagStart; // <html></ht|ml>\r\n    const startOffset = inEndTag ? node.endTagStart : node.start;\r\n    const scanner = createScanner(document.getText(), startOffset);\r\n    let token = scanner.scan();\r\n    function shouldAdvance() {\r\n        if (token === HtmlTokenType.EOS) {\r\n            return false;\r\n        }\r\n        const tokenEnd = scanner.getTokenEnd();\r\n        if (tokenEnd < offset) {\r\n            return true;\r\n        }\r\n        if (tokenEnd === offset) {\r\n            return TRIVIAL_TOKEN.includes(token);\r\n        }\r\n        return false;\r\n    }\r\n    while (shouldAdvance()) {\r\n        token = scanner.scan();\r\n    }\r\n    if (offset > scanner.getTokenEnd()) {\r\n        return NULL_HOVER;\r\n    }\r\n    const tagRange = {\r\n        start: document.positionAt(scanner.getTokenOffset()),\r\n        end: document.positionAt(scanner.getTokenEnd())\r\n    };\r\n    switch (token) {\r\n        case HtmlTokenType.StartTag:\r\n            return getTagHover(node.tag, tagRange, true);\r\n        case HtmlTokenType.EndTag:\r\n            return getTagHover(node.tag, tagRange, false);\r\n        case HtmlTokenType.AttributeName:\r\n            // TODO: treat : as special bind\r\n            const attribute = scanner.getTokenText().replace(/^:/, '');\r\n            return getAttributeHover(node.tag, attribute, tagRange);\r\n    }\r\n    return NULL_HOVER;\r\n}\r\n//# sourceMappingURL=htmlHover.js.map","references":["/Users/yoyo930021/git/vetur/server/src/modes/template/parser/htmlParser.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/parser/htmlScanner.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-types/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/node_modules/vscode-languageserver-textdocument/lib/umd/main.d.ts","/Users/yoyo930021/git/vetur/server/src/modes/template/tagProviders/common.ts","/Users/yoyo930021/git/vetur/server/src/modes/nullMode.ts","/Users/yoyo930021/git/vetur/server/src/utils/strings.ts"],"map":"{\"version\":3,\"file\":\"htmlHover.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../../src/modes/template/services/htmlHover.ts\"],\"names\":[],\"mappings\":\"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\"}","dts":{"name":"/Users/yoyo930021/git/vetur/server/node_modules/.cache/rollup-plugin-typescript2/placeholder/modes/template/services/htmlHover.d.ts","writeByteOrderMark":false,"text":"import { HTMLDocument } from '../parser/htmlParser';\r\nimport { Position, Hover } from 'vscode-languageserver-types';\r\nimport type { TextDocument } from 'vscode-languageserver-textdocument';\r\nimport { IHTMLTagProvider } from '../tagProviders/common';\r\nexport declare function doHover(document: TextDocument, position: Position, htmlDocument: HTMLDocument, tagProviders: IHTMLTagProvider[]): Hover;\r\n"}}
